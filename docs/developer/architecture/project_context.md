# Catalyst 项目上下文

## 项目概述

Catalyst 是一个基于 Electron 的现代化综合性桌面应用程序，集成了系统代理管理、AI 对话、开发环境部署和统一的设置管理等功能。应用采用现代化的 UI/UX 设计，提供稳定、可维护的代码基础，旨在为开发者和技术爱好者提供一个集成了多种实用工具的统一平台。

## 项目目标

### 主要目标
1. **系统代理管理**: 提供基于 Mihomo 的强大系统代理功能，支持代理规则配置和流量管理。
2. **AI 对话集成**: 集成大型语言模型（LLM）对话功能，支持多个提供商。
3. **开发环境部署**: 提供一键部署开发环境的功能，包括 IDE 和运行时环境。
4. **统一设置管理**: 创建一个集中化的设置管理界面，统一管理所有应用配置。
5. **现代化 UI/UX**: 采用现代化的设计语言，提供流畅的用户体验。

### 技术目标
1. **跨平台支持**: 基于 Electron 框架，支持 Windows、macOS 和 Linux。
2. **类型安全**: 全面使用 TypeScript，提供严格的类型检查。
3. **模块化架构**: 采用清晰的模块划分，便于维护和扩展。
4. **性能优化**: 确保应用启动速度和运行性能。
5. **可扩展性**: 设计易于扩展的架构，支持未来功能添加。

## 技术栈

### 核心技术
- **Electron**: 桌面应用框架，提供跨平台支持
- **React 18**: 前端 UI 框架，提供组件化开发
- **TypeScript**: 编程语言，提供类型安全
- **Node.js**: 运行时环境，支持后端逻辑

### UI/UX 技术
- **Styled Components**: CSS-in-JS 样式解决方案
- **Framer Motion**: 动画库，提供流畅的交互效果
- **Lucide React**: 图标库，提供统一的图标风格
- **React Router**: 路由管理，支持单页应用导航

### 后端技术
- **Electron Store**: 配置存储，提供安全的配置管理
- **IPC (进程间通信)**: 主进程和渲染进程间的通信机制
- **Axios**: HTTP 客户端，用于 API 调用
- **Child Process**: 用于执行外部程序（如 Mihomo）

### 构建和开发工具
- **Vite**: 快速的构建工具
- **Electron Vite**: Electron 的 Vite 插件
- **ESLint**: 代码检查工具
- **Prettier**: 代码格式化工具
- **pnpm**: 包管理器，提供高效的依赖管理

## 核心功能模块

### 1. 系统代理管理
- **核心依赖**: Mihomo (Clash.Meta)
- **功能特性**:
  - 代理组管理和切换
  - 代理规则配置
  - 实时状态监控
  - 配置文件管理
  - VPN 提供商 URL 获取配置
- **技术实现**:
  - 通过 child_process 启动和停止 Mihomo 进程
  - 使用 Axios 与 Mihomo REST API 通信
  - 提供可视化的代理组管理界面
  - 统一的代理管理页面，整合所有代理功能

### 2. LLM 对话功能
- **支持提供商**: OpenAI (GPT-3.5, GPT-4)
- **功能特性**:
  - 实时对话界面
  - 消息历史管理
  - API 密钥管理
  - 模型参数配置
  - 修复了 Input 响应问题和状态同步问题
- **技术实现**:
  - 使用 Axios 调用 LLM 提供商 API
  - 实现流式响应处理
  - 提供安全的 API 密钥存储
  - 重构了 sendMessage 函数，解决闭包问题

### 3. 开发环境部署
- **支持工具**:
  - VS Code (代码编辑器)
  - Node.js (JavaScript 运行时)
  - Python (编程语言)
- **功能特性**:
  - 一键安装开发工具
  - 静默安装模式
  - 安装状态监控
- **技术实现**:
  - 使用 child_process 执行安装命令
  - 提供安装进度反馈
  - 支持自定义安装路径

### 4. 统一设置管理系统
- **配置类型**:
  - 通用设置 (主题、语言、开机启动、最小化到托盘、通知)
  - LLM 设置 (提供商、模型、API 密钥)
  - 代理设置 (VPN URL、自动启动)
  - 用户设置 (姓名、邮箱、使用统计)
  - 备份管理 (配置导入导出、备份创建和恢复)
- **功能特性**:
  - 统一的设置界面，分类管理
  - 配置导入/导出
  - 设置重置功能
  - 配置备份和恢复
  - 使用统计和可视化
  - 配置验证和迁移
- **技术实现**:
  - 使用 Electron Store 进行配置存储
  - 通过 IPC 实现设置同步
  - 提供类型安全的设置 API
  - 完整的配置管理器类

### 5. 信息页面
- **功能特性**:
  - 应用介绍和核心功能说明
  - 技术栈和架构介绍
  - 开发者信息和许可证信息
  - 版本历史和未来规划
- **技术实现**:
  - 静态内容展示
  - 响应式设计
  - 与整体主题系统保持一致

## 项目架构

### 进程架构
- **主进程**: 负责系统级操作、窗口管理、进程通信
- **渲染进程**: 负责 UI 渲染、用户交互、业务逻辑
- **预加载脚本**: 提供安全的 API 桥接

### 模块架构
- **服务层**: 封装业务逻辑，提供统一的服务接口
- **IPC 层**: 处理进程间通信，隔离不同进程的逻辑
- **组件层**: 实现 UI 功能，采用组件化设计
- **页面层**: 组合组件实现具体的功能页面

### 数据流架构
- **配置流**: 用户设置 → IPC 通信 → 配置服务 → 配置文件
- **代理流**: 用户操作 → 代理组件 → IPC 通信 → Mihomo 服务 → 代理效果
- **对话流**: 用户输入 → 对话组件 → API 调用 → LLM 服务 → 响应显示

## 开发状态

### 已完成功能 (v1.0.0)
1. ✅ **基础架构搭建**
   - Electron + React + TypeScript 项目结构
   - 主进程和渲染进程分离
   - IPC 通信机制建立
   - 预加载脚本路径问题修复

2. ✅ **系统代理管理**
   - Mihomo 集成和进程管理
   - 代理组管理界面
   - 代理状态监控
   - VPN 提供商 URL 获取配置
   - 统一代理管理页面

3. ✅ **LLM 对话功能**
   - OpenAI API 集成
   - 对话界面实现
   - API 密钥管理
   - Input 响应问题修复
   - 消息状态同步优化

4. ✅ **开发环境部署**
   - VS Code 安装功能
   - Node.js 环境配置
   - 安装状态反馈

5. ✅ **主题系统**
   - 明暗主题切换
   - 主题状态管理
   - 组件主题适配

6. ✅ **统一设置管理系统**
   - 完整的配置管理器类
   - 用户偏好设置管理
   - 应用行为设置管理
   - 使用统计功能
   - 配置备份和恢复
   - 配置验证和迁移
   - 统一设置界面

7. ✅ **信息页面**
   - 应用介绍页面
   - 功能说明文档
   - 开发者信息
   - 版本历史

8. ✅ **导航和路由更新**
   - 侧边栏导航更新
   - 路由配置更新
   - 页面入口统一

### 技术挑战和解决方案

### 1. 应用白屏问题
**挑战**: 应用启动后显示白屏，无法正常渲染。
**解决方案**: 
- 修复了模块导出错误（命名导出 vs 默认导出）
- 修正了预加载脚本路径问题
- 启用开发者工具进行调试

### 2. 窗口控制功能失效
**挑战**: 自定义导航窗口控制栏按钮无响应。
**解决方案**: 
- 发现 electron-vite 将 preload.ts 编译为 preload.js
- 修正了 BrowserWindow 的 preload 路径
- 确保上下文隔离正确设置

### 3. LLM 对话 Input 问题
**挑战**: 对话界面 Input 无法使用，状态不同步。
**解决方案**: 
- 重构 sendMessage 函数，使用函数式状态更新
- 解决闭包问题，确保获取最新状态
- 移除不必要的依赖项

### 4. 配置管理分散
**挑战**: 配置分散在多个地方，缺乏统一管理。
**解决方案**: 
- 创建统一的配置管理器类
- 整合所有配置类型到一个系统
- 支持配置导入导出和备份恢复

### 5. 代理功能分散
**挑战**: 代理功能分散在多个页面，用户体验不佳。
**解决方案**: 
- 创建统一的代理管理页面
- 整合所有代理相关功能
- 简化操作流程

## 代码质量和规范

### TypeScript 规范
- 使用严格的 TypeScript 配置
- 为所有函数和变量添加类型注解
- 定义接口和类型别名
- 使用泛型提供类型灵活性

### React 最佳实践
- 使用函数组件和 Hooks
- 实现组件的单一职责原则
- 使用 Props 和 State 的正确方式
- 优化组件性能（React.memo, useCallback）

### 代码组织
- 清晰的目录结构和文件命名
- 模块化的代码组织
- 统一的导出和导入方式
- 适当的代码注释和文档

### 错误处理
- 实现统一的错误处理机制
- 提供用户友好的错误提示
- 记录错误日志用于调试
- 实现错误恢复机制

## 部署和发布

### 开发环境
- 使用 `pnpm dev` 启动开发服务器
- 支持热重载和调试工具
- 提供开发环境配置

### 生产环境
- 使用 `pnpm build` 构建应用
- 使用 `pnpm package` 打包成可执行文件
- 支持多平台打包（Windows、macOS、Linux）

### 配置管理
- 开发环境和生产环境的配置分离
- 使用环境变量管理敏感信息
- 提供配置验证和默认值

### 配置文件位置
- **Windows**: `%APPDATA%/Catalyst/config/`
- **macOS**: `~/Library/Application Support/Catalyst/config/`
- **Linux**: `~/.config/Catalyst/config/`

## 未来发展方向

### 短期目标 (1-2个月)
1. 🔄 完善错误处理和日志系统
2. 🔄 添加单元测试和集成测试
3. 🔄 优化性能和内存使用
4. 🔄 完善多语言支持

### 中期目标 (3-6个月)
1. 🚀 实现插件系统
2. 🚀 添加云同步功能
3. 🚀 支持多用户账户
4. 🚀 开发主题市场

### 长期目标 (6个月以上)
1. 🚀 移动端适配
2. 🚀 AI 助手功能增强
3. 🚀 社区功能集成
4. 🚀 企业级功能

## 项目特色

### 1. 模块化架构
- 清晰的模块划分，便于维护和扩展
- 统一的接口设计，保证模块间的松耦合
- 服务层、IPC层、组件层、页面层分离

### 2. 类型安全
- 全面的 TypeScript 类型定义
- 严格的类型检查，减少运行时错误
- 完整的接口定义和类型注解

### 3. 现代化 UI
- 响应式设计，适配不同屏幕尺寸
- 流畅的动画效果和交互体验
- 支持明暗主题切换
- 统一的设计语言

### 4. 配置管理
- 统一的配置管理系统
- 支持配置备份和恢复
- 自动配置验证和迁移
- 用户友好的配置界面

### 5. 扩展性
- 插件化的架构设计
- 易于添加新功能和模块
- 完善的开发文档和指南
- 清晰的扩展接口

## 版本历史

### v1.0.0 (当前版本)
- ✅ 完成基础架构搭建
- ✅ 实现系统代理管理功能
- ✅ 集成 LLM 对话功能
- ✅ 添加开发环境部署功能
- ✅ 创建统一的设置管理系统
- ✅ 实现信息页面和导航
- ✅ 完善配置备份和恢复功能
- ✅ 添加使用统计功能
- ✅ 修复所有已知的技术问题

## 总结

Catalyst 项目是一个功能完整的现代化综合性桌面应用程序，成功集成了系统代理管理、AI 对话、开发环境部署和统一设置管理等核心功能。项目采用 Electron + React + TypeScript 的技术栈，具有跨平台支持、类型安全、模块化架构等特点。

通过系统性的问题排查和修复，项目解决了从白屏问题到各种运行时错误的所有已知问题，确保了应用的稳定性和可靠性。统一的配置管理系统和设置界面为用户提供了便捷的配置体验，而统一的代理管理页面则简化了代理功能的操作流程。

项目注重代码质量和开发规范，采用现代化的开发工具和流程，确保应用的可维护性和可扩展性。通过清晰的架构设计和模块化的代码组织，为未来的功能扩展奠定了坚实的基础。

当前版本 (v1.0.0) 已经具备了完整的功能体系和稳定的技术架构，可以满足用户的日常使用需求。未来将继续优化现有功能，并添加插件系统、云同步等高级功能，进一步提升用户体验和应用价值。

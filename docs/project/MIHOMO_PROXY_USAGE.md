# Mihomo 代理功能使用指南

## 1. 概述

本文档介绍了如何在 Catalyst 应用中使用 Mihomo 代理功能，包括系统代理的启动/停止以及代理组的管理和切换。

## 2. 系统代理功能

### 2.1 启动/停止代理

1. 打开 Catalyst 应用
2. 导航到 "系统代理" 页面
3. 点击 "Start" 按钮启动 Mihomo 代理服务
4. 点击 "Stop" 按钮停止 Mihomo 代理服务

### 2.2 状态指示

- 绿色指示灯表示代理正在运行
- 红色指示灯表示代理已停止

## 3. 代理组管理

当 Mihomo 代理服务启动后，代理组管理功能将自动显示在系统代理页面的下方。

### 3.1 查看代理组

代理组管理区域会显示所有配置的代理组，包括：
- 代理组名称
- 代理组类型（如 select, url-test 等）
- 当前选中的代理节点

### 3.2 切换代理

1. 在代理组列表中找到要切换的代理组
2. 点击该代理组中的任意代理节点按钮
3. 系统将自动切换到选中的代理节点

### 3.3 代理组类型说明

- **select**: 手动选择代理节点
- **url-test**: 自动测试并选择延迟最低的代理节点
- **fallback**: 故障转移模式，主节点不可用时自动切换到备用节点

## 4. 配置文件管理

### 4.1 编辑配置文件

1. 导航到 "代理配置" 页面
2. 在文本编辑器中修改 YAML 格式的配置
3. 点击 "Save Config" 保存配置
4. 重启代理服务使配置生效

### 4.2 配置文件结构

配置文件包含以下几个主要部分：

```yaml
# 基础配置
mixed-port: 7890              # 混合端口
allow-lan: true               # 允许局域网连接
mode: rule                    # 代理模式
log-level: info               # 日志级别
external-controller: '127.0.0.1:9090'  # 外部控制器地址

# 代理节点
proxies:
  - name: "代理名称"
    type: ss                  # 代理类型
    server: example.com       # 服务器地址
    port: 8388                # 端口
    # 其他配置...

# 代理组
proxy-groups:
  - name: "代理组名称"
    type: select              # 代理组类型
    proxies:
      - "代理1"
      - "代理2"

# 规则
rules:
  - 'MATCH,代理组名称'        # 匹配规则
```

## 5. 故障排除

### 5.1 代理无法启动

1. 检查 `resources/mihomo.exe` 文件是否存在
2. 检查端口是否被其他程序占用
3. 查看日志输出获取更多信息

### 5.2 代理组无法显示

1. 确保代理服务已启动
2. 检查配置文件中是否定义了代理组
3. 确认 `external-controller` 地址配置正确

### 5.3 代理切换失败

1. 检查网络连接是否正常
2. 确认代理节点配置是否正确
3. 查看 Mihomo 日志获取详细错误信息

## 6. 高级功能

### 6.1 系统代理设置

当前版本暂不支持自动设置系统代理，需要手动配置：
- HTTP 代理: 127.0.0.1:7890
- HTTPS 代理: 127.0.0.1:7890
- SOCKS 代理: 127.0.0.1:7891

### 6.2 延迟测试

未来版本将支持代理节点延迟测试功能，帮助用户选择最佳代理节点。

## 7. 注意事项

1. 修改配置文件后需要重启代理服务才能生效
2. 某些高级配置选项可能需要查阅 Mihomo 官方文档
3. 使用代理时请注意遵守当地法律法规